<!doctype html>
<html>
  <head>
    <title>Tests for jsBytes</title>
  </head>
  <body>
    <script src="jsTest.js"></script>
    <script src="jsBytes.js"></script>
    <div id="results"></div>
    <script>
      var suite = new jsTest.TestSuite();

      suite.addTest('testBytesToHex', function(test) {
        test.assertEqual('0 should generate 00.',
            '00', jsBytes.bytesToHex([0]));
        test.assertEqual('255 should generate FF.',
            'FF', jsBytes.bytesToHex([255]));
        test.assertEqual('Check multi byte array.',
            '0116B90C', jsBytes.bytesToHex([1, 22, 185, 12]));
      });

      suite.addTest('testHexToBytes', function(test) {
        test.assertArraysEqual('00 should generate 0.',
            [0], jsBytes.hexToBytes('00'));
        test.assertArraysEqual('FF should generate 255.',
            [255], jsBytes.hexToBytes('FF'));
        test.assertArraysEqual('Check multi byte array.',
            [1, 22, 185, 12], jsBytes.hexToBytes('0116B90C'));
      });

      suite.addTest('testAppendByte', function(test) {
        var bytes = [];
        jsBytes.appendByte(bytes, 0);
        test.assertArraysEqual('appendByte 0 should succeed.', [0], bytes);
        jsBytes.appendByte(bytes, 255);
        test.assertArraysEqual('appendByte 255 should succeed.',
            [0, 255], bytes);
        test.assertThrows('Should be unable to append -1.',
            function() {jsBytes.appendByte(bytes, -1);});
        test.assertArraysEqual('-1 should not have been added.',
            [0, 255], bytes);
        test.assertThrows('Should be unable to append 256.',
            function() {jsBytes.appendByte(bytes, 256);});
        test.assertArraysEqual('256 should not have been added.',
            [0, 255], bytes);
      });

      suite.addTest('testInt32ToLittleEndianBytes', function(test) {
        test.assertArraysEqual('Check 0', [0,0,0,0], jsBytes.int32ToBytes(0));
        test.assertArraysEqual('Check 255', [255,0,0,0],
            jsBytes.int32ToBytes(255));
        test.assertArraysEqual('Check 256', [0,1,0,0],
            jsBytes.int32ToBytes(256));
        test.assertArraysEqual('Check int max', [255,255,255,127],
            jsBytes.int32ToBytes(2147483647));
        test.assertArraysEqual('Check unsigned int max', [255,255,255,255],
            jsBytes.int32ToBytes(4294967295));
        test.assertArraysEqual('Check -1', [255,255,255,255],
            jsBytes.int32ToBytes(-1));
        test.assertArraysEqual('Check -2', [254,255,255,255],
            jsBytes.int32ToBytes(-2));
        test.assertArraysEqual('Check -256', [0,255,255,255],
            jsBytes.int32ToBytes(-256));
        test.assertArraysEqual('Check -257', [255,254,255,255],
            jsBytes.int32ToBytes(-257));
        test.assertArraysEqual('Check negative int max', [0,0,0,128],
            jsBytes.int32ToBytes(-2147483648));
        test.assertThrows('Check beyond negative int max',
            function() {jsBytes.int32ToBytes(-2147483649);});
        test.assertThrows('Check beyond unsigned int max',
            function() {jsBytes.int32ToBytes(4294967296);});
        test.assertThrows('Check floating point input',
            function() {jsBytes.int32ToBytes(2.02);});
      });

      suite.addTest('testInt32ToBigEndianBytes', function(test) {
        test.assertArraysEqual('Check 255', [0,0,0,255],
            jsBytes.int32ToBytes(255, true));
        test.assertArraysEqual('Check 256', [0,0,1,0],
            jsBytes.int32ToBytes(256, true));
        test.assertArraysEqual('Check int max', [127,255,255,255],
            jsBytes.int32ToBytes(2147483647, true));
        test.assertArraysEqual('Check -2', [255,255,255,254],
            jsBytes.int32ToBytes(-2, true));
        test.assertArraysEqual('Check -256', [255,255,255, 0],
            jsBytes.int32ToBytes(-256, true));
        test.assertArraysEqual('Check -257', [255,255,254,255],
            jsBytes.int32ToBytes(-257, true));
        test.assertArraysEqual('Check negative int max', [128,0,0,0],
            jsBytes.int32ToBytes(-2147483648, true));
      });

      suite.addTest('testLittleEndianBytesToSignedInt32', function(test) {
          test.assertEqual('Check 0', 0,
              jsBytes.littleEndianBytesToSignedInt32([0, 0, 0, 0]));
          test.assertEqual('Check 1', 1,
              jsBytes.littleEndianBytesToSignedInt32([1, 0, 0, 0]));
          test.assertEqual('Check 256', 256,
              jsBytes.littleEndianBytesToSignedInt32([0, 1, 0, 0]));
          test.assertEqual('Check 65,536', 65536,
              jsBytes.littleEndianBytesToSignedInt32([0, 0, 1, 0]));
          test.assertEqual('Check int max', 2147483647,
              jsBytes.littleEndianBytesToSignedInt32([255,255,255,127]));
          test.assertEqual('Check 1 with start index', 1,
              jsBytes.littleEndianBytesToSignedInt32([255, 1, 0, 0, 0], 1));


          test.assertThrows('Too few bytes',
              function() {jsBytes.littleEndianBytesToSignedInt32([1,1,1]);});
          test.assertThrows('Too few bytes with index',
              function() {jsBytes.littleEndianBytesToSignedInt32([1,1,1,1], 1);});
          test.assertThrows('Negative start index',
              function() {jsBytes.littleEndianBytesToSignedInt32([1,1,1,1], -1);});

          test.assertEqual('Check -2', -2,
              jsBytes.littleEndianBytesToSignedInt32([254,255,255,255]));
          test.assertEqual('Check -256', -256,
              jsBytes.littleEndianBytesToSignedInt32([0,255,255,255]));
          test.assertEqual('Check -257', -257,
              jsBytes.littleEndianBytesToSignedInt32([255,254,255,255]));
          test.assertEqual('Check negative int max', -2147483648,
              jsBytes.littleEndianBytesToSignedInt32([0,0,0,128]));
      });

      suite.addTest('testBigEndianBytesToSignedInt32', function(test) {
          test.assertEqual('Check 0', 0,
              jsBytes.bigEndianBytesToSignedInt32([0, 0, 0, 0]));
          test.assertEqual('Check 1', 1,
              jsBytes.bigEndianBytesToSignedInt32([0, 0, 0, 1]));
          test.assertEqual('Check 256', 256,
              jsBytes.bigEndianBytesToSignedInt32([0, 0, 1, 0]));
          test.assertEqual('Check 65,536', 65536,
              jsBytes.bigEndianBytesToSignedInt32([0, 1, 0, 0]));
          test.assertEqual('Check int max', 2147483647,
              jsBytes.bigEndianBytesToSignedInt32([127,255,255,255]));
          test.assertEqual('Check 1 with start index', 1,
              jsBytes.bigEndianBytesToSignedInt32([255, 0, 0, 0, 1], 1));


          test.assertEqual('Check -2', -2,
              jsBytes.bigEndianBytesToSignedInt32([255,255,255,254]));
          test.assertEqual('Check -256', -256,
              jsBytes.bigEndianBytesToSignedInt32([255,255,255,0]));
          test.assertEqual('Check -257', -257,
              jsBytes.bigEndianBytesToSignedInt32([255,255,254,255]));
          test.assertEqual('Check negative int max', -2147483648,
              jsBytes.bigEndianBytesToSignedInt32([128,0,0,0]));
      });

      suite.addTest('testLittleEndianBytesToUnsignedInt32', function(test) {
          test.assertEqual('Check signed int max + 1', 2147483648,
              jsBytes.littleEndianBytesToUnsignedInt32([0,0,0,128]));
          test.assertEqual('Check unsigned int max', 4294967295,
              jsBytes.littleEndianBytesToUnsignedInt32([255,255,255,255]));
      });

      suite.addTest('testBigEndianBytesToUnsignedInt32', function(test) {
          test.assertEqual('Check signed int max + 1', 2147483648,
              jsBytes.bigEndianBytesToUnsignedInt32([128,0,0,0]));
          test.assertEqual('Check unsigned int max', 4294967295,
              jsBytes.bigEndianBytesToUnsignedInt32([255,255,255,255]));
      });

      suite.addTest('testStringToUtf8Bytes', function(test) {
          test.assertArraysEqual('Check ASCII text', [72, 105, 33],
              jsBytes.stringToUtf8Bytes('Hi!'));
          test.assertArraysEqual('Section symbol', [0xC2, 0xA7],
              jsBytes.stringToUtf8Bytes('\u00A7'));
          test.assertArraysEqual('Division symbol', [0xC3, 0xB7],
              jsBytes.stringToUtf8Bytes('\u00F7'));
          test.assertArraysEqual('Division symbol', [0xC3, 0xB7],
              jsBytes.stringToUtf8Bytes('\u00F7'));
          test.assertArraysEqual('Alpha', [0xCE, 0xB1],
              jsBytes.stringToUtf8Bytes('\u03B1'));
          test.assertArraysEqual('Full width z', [0xEF, 0xBD, 0x9A],
              jsBytes.stringToUtf8Bytes('\uFF5A'));
      });

      suite.addTest('testUtf8BytesToString', function(test) {
          test.assertEqual('Check ASCII text', 'Hi!',
              jsBytes.utf8BytesToString([72, 105, 33]));
          test.assertEqual('Section symbol', '\u00A7',
              jsBytes.utf8BytesToString([0xC2, 0xA7]));
          test.assertEqual('Division symbol', '\u00F7',
              jsBytes.utf8BytesToString([0xC3, 0xB7]));
          test.assertEqual('Alpha', '\u03B1',
              jsBytes.utf8BytesToString([0xCE, 0xB1]));
          test.assertEqual('Full width z', '\uFF5A',
              jsBytes.utf8BytesToString([0xEF, 0xBD, 0x9A]));
          
          /*test.assertArraysEqual('Section symbol', [0xC2, 0xA7],
              jsBytes.stringToUtf8Bytes('\u00A7'));
          test.assertArraysEqual('Division symbol', [0xC3, 0xB7],
              jsBytes.stringToUtf8Bytes('\u00F7'));
          test.assertArraysEqual('Division symbol', [0xC3, 0xB7],
              jsBytes.stringToUtf8Bytes('\u00F7'));
          test.assertArraysEqual('Alpha', [0xCE, 0xB1],
              jsBytes.stringToUtf8Bytes('\u03B1'));
          test.assertArraysEqual('Full width z', [0xEF, 0xBD, 0x9A],
              jsBytes.stringToUtf8Bytes('\uFF5A'));*/
      });

      suite.runTests(document.getElementById('results'));
    </script>
  </body>
</html>
